<html>
<head>
	<title></title>
	<meta charset='utf-8'>
	<link rel="stylesheet" type="text/css" href="css/jquerymobile.css">
	<link rel="stylesheet" type="text/css" href="http://code.google.com/apis/maps/documentation/javascript/examples/default.css">
	<link rel="stylesheet" type="text/css" href="css/styles.css">
	<script type="text/javascript" src="js/jquery.js"></script>
	<script type="text/javascript" src="js/jquerymobile.js"></script>
	<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
	<script type="text/javascript" src="js/cordova-2.3.0"></script>
	<script type="text/javascript" src="js/html5sql.js"></script>

	<script type="text/javascript">
	var lat, lon, map, demoRunning;
	$(document).bind("pageshow", "#firstpage",function(evt, data){
		navigator.geolocation.getCurrentPosition(onGeoSuccess, onGeoError, { maximumAge: 3000, timeout: 5000, enableHighAccuracy: true });
		db = window.openDatabase("databaseName", "1.0", "Display Name", 200000);
	})

	function getFarolas(tx){
		alert("llega a getFarolas");
		tx.executeSql("SELECT * FROM farola", [], getFarolasOK, error);
	}
	function createTables(tx){
		tx.executeSql("DROP TABLE IF EXISTS farola;");
		tx.executeSql("CREATE TABLE IF NOT EXISTS farola (id, latitud, longitud);");
		tx.executeSql("INSERT INTO farola (id,latitud, longitud) VALUES(0, 41.39991, 2.171942);");
	}

	function getFarolasOK(tx, results){
		var len = results.rows.length;
		alert("llega a getFarolasOK. length: " + len);

		var output = "";
		for(var i = 0; i<len; i++){
			latitud = results.rows.item(i).latitud;
			longitud = results.rows.item(i).longitud;
			putFarola(latitud, longitud);
		}
	}
	function error(error){
		alert("hubo un error: " + error.message);
	}
	function onGeoSuccess(position){
		var lat = position.coords.latitude;
		var lon = position.coords.longitude;
		var currentPosition = new google.maps.LatLng(lat, lon);
		var mapoptions = {
			zoom : 12,
			center: currentPosition,
			mapTypeId: google.maps.MapTypeId.ROADMAP
		};
		map = new google.maps.Map(document.getElementById("map"), mapoptions);

		var marker = new google.maps.Marker({
			position: currentPosition,
			map: map,
		});
		db.transaction(createTables, error, transactionOK);
		db.transaction(getFarolas, error, transactionOK);
	}
	function onGeoError(error){
		if(error==1){
			alert("turn on geolocation services")
		}else{
			alert("geoError: " + error);
			alert("geoError: " + error.message);
		}
	}

	function putFarola(lat, lon){
		alert("lat y lon" + lat);
		var latlng = new google.maps.LatLng(lat, lon);

var pinIcon = new google.maps.MarkerImage(
			"img/farola.svg",
			null,
			null,
			null,
			new google.maps.Size(20, 50)
			);
//icon: "http://www.gettyicons.com/free-icons/108/gis-gps/png/24/needle_left_yellow_2_24.png"

var mapMarker = new google.maps.Marker({
	position:latlng,
	title: "Estás aquí.",
	icon: pinIcon
});


mapMarker.setMap(map);
}


function transactionOK(){

}

</script>

</head>
<body>
	<section id="firstpage" data-role="page">
		<header data-role="header">
			<h1>Cabecera</h1>
		</header>
		<div class="content" data-role="content">
			<div id="map" ></div>
			<div id="results"></div>
		</div>
		<footer data-role="footer">El pie de la página</footer>
	</section>
	<button click="getFarolas()"></button>
</body>
</html>